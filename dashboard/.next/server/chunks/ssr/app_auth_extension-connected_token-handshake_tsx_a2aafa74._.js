module.exports=[52751,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(40695);function e(){let a=(0,c.useRef)(!1),[e,f]=(0,c.useState)("Generating secure token..."),[g,h]=(0,c.useState)(!1),[i,j]=(0,c.useState)(!1),[k,l]=(0,c.useState)(null);return((0,c.useEffect)(()=>{a.current||(a.current=!0,console.log("[v0] TokenHandshake: Starting token generation"),b());async function b(){try{console.log("[v0] TokenHandshake: Calling /api/extension/token");let a=await fetch("/api/extension/token",{method:"POST"});if(!a.ok){let b=await a.json().catch(()=>({error:"Unknown error"}));throw console.error("[v0] TokenHandshake: API error",b),Error(b.error||"Token generation failed")}let{token:b,userId:c}=await a.json();console.log("[v0] TokenHandshake: Token received, userId:",c);let d=document.getElementById("extension-auth-data");d?(d.setAttribute("data-ext-token",b),d.setAttribute("data-user-id",c),console.log("[v0] TokenHandshake: Token written to DOM")):console.error("[v0] TokenHandshake: extension-auth-data element not found"),l({token:b,userId:c}),f("Waiting for extension to sync..."),h(!1);try{window.postMessage({type:"XREPLY_AUTH_TOKEN",token:b,userId:c},"*"),console.log("[v0] TokenHandshake: Posted message to window")}catch(a){console.error("[v0] TokenHandshake: Failed to post message:",a)}setTimeout(()=>{d?.getAttribute("data-ext-token")&&(console.log("[v0] TokenHandshake: Token still in DOM after 3s - extension script not running"),j(!0),f("Extension not detected"))},3e3)}catch(a){console.error("[v0] TokenHandshake: Error",a),f(a instanceof Error?a.message:"Failed to generate token. Please try again."),h(!0)}}},[]),i)?(0,b.jsxs)("div",{className:"flex flex-col gap-4 max-w-md",children:[(0,b.jsxs)("div",{className:"rounded-lg border border-border bg-muted/50 p-4",children:[(0,b.jsx)("p",{className:"text-sm font-semibold mb-3",children:"Complete the connection:"}),(0,b.jsxs)("ol",{className:"text-sm text-muted-foreground list-decimal list-inside space-y-2 mb-4",children:[(0,b.jsxs)("li",{children:["Click the ",(0,b.jsx)("strong",{children:"X Reply Generator"})," icon in your browser toolbar"]}),(0,b.jsx)("li",{children:"The extension popup will detect your authentication automatically"})]}),(0,b.jsx)(d.Button,{onClick:()=>{alert("Now click the X Reply Generator extension icon in your browser toolbar to complete the connection.")},className:"w-full",children:"Open Extension Popup"})]}),(0,b.jsxs)("details",{className:"text-xs text-muted-foreground",children:[(0,b.jsx)("summary",{className:"cursor-pointer font-medium mb-2",children:"Still not working? Try this:"}),(0,b.jsxs)("ol",{className:"list-decimal list-inside space-y-1.5 mt-2 ml-2",children:[(0,b.jsxs)("li",{children:["Open ",(0,b.jsx)("kbd",{className:"px-1 py-0.5 rounded bg-muted",children:"chrome://extensions"})]}),(0,b.jsx)("li",{children:'Find "X Reply Generator"'}),(0,b.jsx)("li",{children:"Click the reload icon (circular arrow)"}),(0,b.jsx)("li",{children:"Close and reopen the extension popup"})]})]})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{id:"extension-auth-status",className:"text-sm text-muted-foreground",style:{color:g?"#ef4444":void 0},children:e}),k&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("input",{type:"hidden",id:"__ATOMIX_TOKEN__",value:k.token}),(0,b.jsx)("input",{type:"hidden",id:"__ATOMIX_USER_ID__",value:k.userId})]})]})}a.s(["ExtensionTokenHandshake",()=>e])}];

//# sourceMappingURL=app_auth_extension-connected_token-handshake_tsx_a2aafa74._.js.map