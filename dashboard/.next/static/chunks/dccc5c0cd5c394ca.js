(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,71937,e=>{"use strict";var t=e.i(43476),n=e.i(71645),o=e.i(67881);function s(){let e=(0,n.useRef)(!1),[s,r]=(0,n.useState)("Generating secure token..."),[i,a]=(0,n.useState)(!1),[l,d]=(0,n.useState)(!1),[c,u]=(0,n.useState)(null);return((0,n.useEffect)(()=>{e.current||(e.current=!0,console.log("[v0] TokenHandshake: Starting token generation"),t());async function t(){try{console.log("[v0] TokenHandshake: Calling /api/extension/token");let e=await fetch("/api/extension/token",{method:"POST"});if(!e.ok){let t=await e.json().catch(()=>({error:"Unknown error"}));throw console.error("[v0] TokenHandshake: API error",t),Error(t.error||"Token generation failed")}let{token:t,userId:n}=await e.json();console.log("[v0] TokenHandshake: Token received, userId:",n);let o=document.getElementById("extension-auth-data");o?(o.setAttribute("data-ext-token",t),o.setAttribute("data-user-id",n),console.log("[v0] TokenHandshake: Token written to DOM")):console.error("[v0] TokenHandshake: extension-auth-data element not found"),u({token:t,userId:n}),r("Waiting for extension to sync..."),a(!1);try{window.postMessage({type:"XREPLY_AUTH_TOKEN",token:t,userId:n},"*"),console.log("[v0] TokenHandshake: Posted message to window")}catch(e){console.error("[v0] TokenHandshake: Failed to post message:",e)}setTimeout(()=>{o?.getAttribute("data-ext-token")&&(console.log("[v0] TokenHandshake: Token still in DOM after 3s - extension script not running"),d(!0),r("Extension not detected"))},3e3)}catch(e){console.error("[v0] TokenHandshake: Error",e),r(e instanceof Error?e.message:"Failed to generate token. Please try again."),a(!0)}}},[]),l)?(0,t.jsxs)("div",{className:"flex flex-col gap-4 max-w-md",children:[(0,t.jsxs)("div",{className:"rounded-lg border border-border bg-muted/50 p-4",children:[(0,t.jsx)("p",{className:"text-sm font-semibold mb-3",children:"Complete the connection:"}),(0,t.jsxs)("ol",{className:"text-sm text-muted-foreground list-decimal list-inside space-y-2 mb-4",children:[(0,t.jsxs)("li",{children:["Click the ",(0,t.jsx)("strong",{children:"X Reply Generator"})," icon in your browser toolbar"]}),(0,t.jsx)("li",{children:"The extension popup will detect your authentication automatically"})]}),(0,t.jsx)(o.Button,{onClick:()=>{alert("Now click the X Reply Generator extension icon in your browser toolbar to complete the connection.")},className:"w-full",children:"Open Extension Popup"})]}),(0,t.jsxs)("details",{className:"text-xs text-muted-foreground",children:[(0,t.jsx)("summary",{className:"cursor-pointer font-medium mb-2",children:"Still not working? Try this:"}),(0,t.jsxs)("ol",{className:"list-decimal list-inside space-y-1.5 mt-2 ml-2",children:[(0,t.jsxs)("li",{children:["Open ",(0,t.jsx)("kbd",{className:"px-1 py-0.5 rounded bg-muted",children:"chrome://extensions"})]}),(0,t.jsx)("li",{children:'Find "X Reply Generator"'}),(0,t.jsx)("li",{children:"Click the reload icon (circular arrow)"}),(0,t.jsx)("li",{children:"Close and reopen the extension popup"})]})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{id:"extension-auth-status",className:"text-sm text-muted-foreground",style:{color:i?"#ef4444":void 0},children:s}),c&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("input",{type:"hidden",id:"__ATOMIX_TOKEN__",value:c.token}),(0,t.jsx)("input",{type:"hidden",id:"__ATOMIX_USER_ID__",value:c.userId})]})]})}e.s(["ExtensionTokenHandshake",()=>s])}]);